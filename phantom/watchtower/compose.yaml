secrets:
  WATCHTOWER_HTTP_API_TOKEN:
    file: ./secrets/WATCHTOWER_HTTP_API_TOKEN
  WATCHTOWER_NOTIFICATION_URL:
    file: ./secrets/WATCHTOWER_NOTIFICATION_URL

services:
  watchtower:
    command:
      - --http-api-periodic-polls
      - --http-api-update
    container_name: watchtower
    depends_on:
      - caddy
    environment:
      WATCHTOWER_CLEANUP: true
      WATCHTOWER_HTTP_API_TOKEN: /run/secrets/WATCHTOWER_HTTP_API_TOKEN
      WATCHTOWER_NOTIFICATION_URL: /run/secrets/WATCHTOWER_NOTIFICATION_URL
    image: containrrr/watchtower
    networks:
      - caddy-watchtower
    restart: always
    secrets:
      - WATCHTOWER_HTTP_API_TOKEN
      - WATCHTOWER_NOTIFICATION_URL
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro

      - /etc/localtime:/etc/localtime:ro
      - /etc/timezone:/etc/timezone:ro
