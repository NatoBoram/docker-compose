services:
  kubo:
    container_name: kubo
    env_file:
      - .env.kubo
      - .env.kubo.local
    healthcheck:
      test:
        - CMD-SHELL
        - ipfs --api=/ip4/127.0.0.1/tcp/5001 --api-auth=bearer:$${BEARER} dag stat /ipfs/QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn || exit 1
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s
    hostname: phantom
    image: ipfs/kubo
    depends_on:
      - caddy
    networks:
      - caddy-kubo
    ports:
      - 127.0.0.1:5001:5001
      - 4001:4001/tcp
      - 4001:4001/udp
      - 8080:8080
    restart: always
    volumes:
      - kubo:/data/ipfs

      - /etc/localtime:/etc/localtime:ro
      - /etc/timezone:/etc/timezone:ro

volumes:
  kubo:
